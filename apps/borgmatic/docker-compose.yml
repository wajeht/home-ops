services:
  borgmatic:
    container_name: borgmatic
    image: ghcr.io/borgmatic-collective/borgmatic:2.1.2@sha256:961533d6135fd67736e9fee0f7cebc4926b57840d4a210be0a0cf2de6b004996
    env_file:
      - .env
    environment:
      - TZ=America/Chicago
    volumes:
      - /home/jaw/data:/source/data:ro
      - /home/jaw/.sops:/source/sops:ro
      - /home/jaw/backup/borg:/repository
      - /home/jaw/data/borgmatic:/borgmatic/state
      - ./config.yml:/etc/borgmatic/config.yaml:ro
      - ./crontab.txt:/etc/borgmatic.d/crontab.txt:ro
    networks:
      - traefik
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 1G

networks:
  traefik:
    external: true
