# Requires 2.33.5+ for Docker 29 API compatibility (older versions misdetect as Podman)
services:
  portainer:
    image: portainer/portainer-ce:2.38.1-alpine@sha256:aac56f1e2ccb8334b5a09b42ef9f275fd79ab05a6bfca40405a48e71ce6077cc
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /home/jaw/data/portainer:/data
    networks:
      - proxy
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:9000/api/system/status",
        ]
      interval: 30s
      timeout: 5s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 256M
    labels:
      caddy: portainer.jaw.dev
      caddy.import: auth-admin
      caddy.reverse_proxy: "{{upstreams 9000}}"

networks:
  proxy:
    external: true
